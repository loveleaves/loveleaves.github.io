<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="ä¸»è¦ä»‹ç»åˆ©ç”¨ONNXã€ONNXRuntimeé‡åŒ–åŠæ¨ç†">
<title>ã€ONNXé‡åŒ–ã€‘ ONNXé‡åŒ–æ¨ç†ä»‹ç»</title>

<link rel='canonical' href='https://loveleaves.github.io/p/onnx_quantization/'>

<link rel="stylesheet" href="/scss/style.min.4f655c339a336b15a106fd248f9170c8064dfc6f1990313665402f49a0c0831e.css"><meta property='og:title' content="ã€ONNXé‡åŒ–ã€‘ ONNXé‡åŒ–æ¨ç†ä»‹ç»">
<meta property='og:description' content="ä¸»è¦ä»‹ç»åˆ©ç”¨ONNXã€ONNXRuntimeé‡åŒ–åŠæ¨ç†">
<meta property='og:url' content='https://loveleaves.github.io/p/onnx_quantization/'>
<meta property='og:site_name' content='å®‰å“²ç¿'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-02-20T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-03-07T19:52:49&#43;08:00'/>
<meta name="twitter:title" content="ã€ONNXé‡åŒ–ã€‘ ONNXé‡åŒ–æ¨ç†ä»‹ç»">
<meta name="twitter:description" content="ä¸»è¦ä»‹ç»åˆ©ç”¨ONNXã€ONNXRuntimeé‡åŒ–åŠæ¨ç†">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_25fc10c33a9a76ac.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ˜</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">å®‰å“²ç¿</a></h1>
            <h2 class="site-description">ä¸–ä¸Šæ— éš¾äº‹ï¼Œåªæ€•æœ‰å¿ƒäºº</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/loveleaves'
                        target="_blank"
                        title="Github"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/loveleaves'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://loveleaves.github.io/en/" >English</option>
                                
                                    <option value="https://loveleaves.github.io/" selected>ç®€ä½“ä¸­æ–‡</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#references">References</a></li>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#onnx-quantization">ONNX Quantization</a></li>
    <li><a href="#create-float16-and-mixed-precision-models">Create Float16 and Mixed Precision Models</a></li>
    <li><a href="#ort-model-format">ORT model format</a></li>
    <li><a href="#onnx">ONNX</a>
      <ol>
        <li><a href="#onnxæ–‡ä»¶ä»‹ç»">ONNXæ–‡ä»¶ä»‹ç»</a></li>
        <li><a href="#onnxç»“æ„">ONNXç»“æ„</a></li>
        <li><a href="#onnxæ–‡ä»¶æ“ä½œ">ONNXæ–‡ä»¶æ“ä½œ</a></li>
        <li><a href="#onnxæ¨¡å‹æ–‡ä»¶æ­£ç¡®å¯¼å‡º">ONNXæ¨¡å‹æ–‡ä»¶æ­£ç¡®å¯¼å‡º</a>
          <ol>
            <li><a href="#torchonnxexport">torch.onnx.export</a></li>
            <li><a href="#torchonnxexport-dynamotrue">torch.onnx.export(&hellip;, dynamo=True)</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#example">Example</a>
      <ol>
        <li><a href="#simple-example">Simple Example</a></li>
        <li><a href="#yolov8">YOLOv8</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/quantization/" >
                Quantization
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/onnx_quantization/">ã€ONNXé‡åŒ–ã€‘ ONNXé‡åŒ–æ¨ç†ä»‹ç»</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            ä¸»è¦ä»‹ç»åˆ©ç”¨ONNXã€ONNXRuntimeé‡åŒ–åŠæ¨ç†
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 20, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 5 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="references">References
</h2><ul>
<li><a class="link" href="https://github.com/loveleaves/onnx-quantization"  target="_blank" rel="noopener"
    >onnxé‡åŒ–æ¨ç†ä¾‹å­</a></li>
<li><a class="link" href="https://onnxruntime.ai/docs/"  target="_blank" rel="noopener"
    >onnxruntime docs</a></li>
<li><a class="link" href="https://onnxruntime.ai/docs/performance/model-optimizations/quantization.html"  target="_blank" rel="noopener"
    >onnxruntime quantization</a></li>
<li><a class="link" href="https://github.com/microsoft/onnxruntime-inference-examples/blob/main/quantization/image_classification/cpu/ReadMe.md"  target="_blank" rel="noopener"
    >ONNX Runtime Quantization Example</a>, Pre-processing step</li>
</ul>
<h2 id="overview">Overview
</h2><p>Quantization in ONNX Runtime refers to 8 bit linear quantization of an ONNX model.</p>
<p>During quantization, the floating point values are mapped to an 8 bit quantization space of the form: <code>val_fp32 = scale * (val_quantized - zero_point)</code></p>
<p><code>scale</code> is a positive real number used to map the floating point numbers to a quantization space. It is calculated as follows:</p>
<p>For asymmetric quantization:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> scale = (data_range_max - data_range_min) / (quantization_range_max - quantization_range_min)
</span></span></code></pre></td></tr></table>
</div>
</div><p>For symmetric quantization:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> scale = max(abs(data_range_max), abs(data_range_min)) * 2 / (quantization_range_max - quantization_range_min)
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>zero_point</code> represents zero in the quantization space. It is important that the floating point zero value be exactly representable in quantization space. This is because zero padding is used in many CNNs. If it is not possible to represent 0 uniquely after quantization, it will result in accuracy errors.</p>
<p><img src="/imgs/quantization/1.png"
	
	
	
	loading="lazy"
	
		alt="quantization"
	
	
></p>
<h2 id="onnx-quantization">ONNX Quantization
</h2><ul>
<li><a class="link" href="https://onnxruntime.ai/docs/performance/model-optimizations/quantization.html"  target="_blank" rel="noopener"
    >introduction</a></li>
</ul>
<p>ONNX Runtime provides python APIs for converting 32-bit floating point model to an 8-bit integer model, a.k.a. quantization. These APIs include pre-processing, dynamic/static quantization, and debugging.</p>
<ul>
<li>Pre-processing: Pre-processing is to transform a float32 model to prepare it for quantization. The goal of these steps is to improve quantization quality.</li>
<li>Dynamic Quantization: Dynamic quantization calculates the quantization parameters (scale and zero point) for activations dynamically.</li>
<li>Static Quantization: quantization parameters are calculated in advance (offline) using a calibration data set.</li>
<li>Quantization Debugging: Quantization may negatively affect a modelâ€™s accuracy. A solution to this problem is to compare the weights and activations tensors of the original computation graph vs those of the quantized one, identify where they differ most, and avoid quantizing these tensors, or choose another quantization/calibration method.</li>
</ul>
<h2 id="create-float16-and-mixed-precision-models">Create Float16 and Mixed Precision Models
</h2><ul>
<li><a class="link" href="https://onnxruntime.ai/docs/performance/model-optimizations/float16.html"  target="_blank" rel="noopener"
    >offical web</a></li>
</ul>
<p>Converting a model to use float16 instead of float32 can decrease the model size (up to half) and improve performance on some GPUs. There may be some accuracy loss, but in many models the new accuracy is acceptable. Tuning data is not needed for float16 conversion, which can make it preferable to quantization.</p>
<h2 id="ort-model-format">ORT model format
</h2><p>The <a class="link" href="https://onnxruntime.ai/docs/performance/model-optimizations/ort-format-models.html"  target="_blank" rel="noopener"
    >ORT</a> format is the format supported by reduced size ONNX Runtime builds. Reduced size builds may be more appropriate for use in size-constrained environments such as mobile and web applications.</p>
<p>Both ORT format models and ONNX models are supported by a full ONNX Runtime build.</p>
<h2 id="onnx">ONNX
</h2><ul>
<li><a class="link" href="https://github.com/onnx/tutorials"  target="_blank" rel="noopener"
    >onnx tutorial</a></li>
</ul>
<h3 id="onnxæ–‡ä»¶ä»‹ç»">ONNXæ–‡ä»¶ä»‹ç»
</h3><ul>
<li>1ã€.ONNXçš„æœ¬è´¨ï¼Œæ˜¯ä¸€ç§<a class="link" href="https://github.com/protocolbuffers/protobuf"  target="_blank" rel="noopener"
    >Protobuf</a>æ ¼å¼æ–‡ä»¶</li>
<li>2ã€Protobufåˆ™é€šè¿‡onnx-ml.protoç¼–è¯‘å¾—åˆ°onnx-ml.pb.hå’Œonnx-ml.pb.ccæˆ–onnx_ml_pb2.py
<img src="/imgs/2.png"
	
	
	
	loading="lazy"
	
	
></li>
<li>3ã€ç„¶åç”¨onnxâ€”ml.pb.ccå’Œä»£ç æ¥æ“ä½œonnxæ¨¡å‹æ–‡ä»¶ï¼Œå®ç°å¢åˆ æ”¹</li>
<li>4ã€onnxâ€”ml.protoåˆ™æ˜¯æè¿°onnxæ–‡ä»¶å¦‚ä½•ç»„æˆçš„ï¼Œå…·æœ‰ä»€ä¹ˆç»“æ„ï¼Œä»–æ˜¯æ“ä½œonnxç»å¸¸å‚ç…§çš„ä¸œè¥¿</li>
<li><a class="link" href="https://github.com/onnx/onnx/blob/main/docs/IR.md"  target="_blank" rel="noopener"
    >details</a>ã€<a class="link" href="https://onnx.ai/onnx/intro/concepts.html"  target="_blank" rel="noopener"
    >concepts</a></li>
</ul>
<h3 id="onnxç»“æ„">ONNXç»“æ„
</h3><p><img src="/imgs/3.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>modelï¼šè¡¨ç¤ºæ•´ä¸ªonnxçš„æ¨¡å‹ï¼ŒåŒ…å«å›¾ç»“æ„å’Œè§£æå™¨æ ¼å¼ã€opsetç‰ˆæœ¬ã€å¯¼å‡ºç¨‹åºç±»å‹model.graphï¼šè¡¨ç¤ºå›¾ç»“æ„ï¼Œé€šå¸¸æ˜¯æˆ‘ä»¬netronçœ‹åˆ°çš„ä¸»è¦ç»“æ„</li>
<li>model.graph.node:è¡¨ç¤ºå›¾ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ•°ç»„ï¼Œä¾‹å¦‚convã€bnç­‰èŠ‚ç‚¹å°±æ˜¯åœ¨è¿™é‡Œçš„ï¼Œé€šè¿‡inputã€output è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»</li>
<li>model.graph.initializer:æƒé‡ç±»çš„æ•°æ®å¤§éƒ½å‚¨å­˜åœ¨è¿™é‡Œ</li>
<li>model.graph.inputï¼šæ•´ä¸ªæ¨¡å‹çš„è¾“å…¥å‚¨å­˜åœ¨è¿™é‡Œï¼Œè¡¨æ˜å“ªä¸ªèŠ‚ç‚¹æ˜¯è¾“å…¥èŠ‚ç‚¹ï¼Œshapeæ˜¯å¤šå°‘model.graph.outputï¼šæ•´ä¸ªæ¨¡å‹çš„è¾“å‡ºå‚¨å­˜åœ¨è¿™é‡Œï¼Œè¡¨æ˜å“ªä¸ªèŠ‚ç‚¹æ˜¯è¾“å‡ºèŠ‚ç‚¹ï¼Œshapeæ˜¯å¤šå°‘</li>
<li>å¯¹äºanchorgridç±»çš„å¸¸é‡æ•°æ®ï¼Œé€šå¸¸ä¼šå‚¨å­˜åœ¨model.graph.nodeä¸­ï¼Œå¹¶æŒ‡å®šç±»å‹ä¸ºConstant,è¯¥ç±»å‹èŠ‚ç‚¹åœ¨ netronä¸­å¯è§†åŒ–æ—¶ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥</li>
<li><a class="link" href="https://blog.csdn.net/Rolandxxx/article/details/127713806"  target="_blank" rel="noopener"
    >onnxæ–‡ä»¶åŠå…¶ç»“æ„ã€æ­£ç¡®å¯¼å‡ºonnxã€onnxè¯»å–ã€onnxåˆ›å»ºã€onnxä¿®æ”¹ã€onnxè§£æå™¨</a></li>
</ul>
<h3 id="onnxæ–‡ä»¶æ“ä½œ">ONNXæ–‡ä»¶æ“ä½œ
</h3><ul>
<li><a class="link" href="./onnx-editor/readme.md" >code</a></li>
<li>1.ONNXçš„ä¸»è¦ç»“æ„ï¼šgraphã€graph.nodeã€graph.initializerã€graph.inputã€graph.output</li>
<li>2.ONNXçš„èŠ‚ç‚¹æ„å»ºæ–¹å¼ï¼šonnx.helper,å„ç§makeå‡½æ•°</li>
<li>3.ONNXçš„protoæ–‡ä»¶ï¼š<a class="link" href="https:/github.com/onnx/onnx/blob/main/onnx/onnx-ml.proto"  target="_blank" rel="noopener"
    >onnx-proto2</a></li>
<li>4.ç†è§£æ¨¡å‹ç»“æ„çš„å‚¨å­˜ã€æƒé‡çš„å‚¨å­˜ã€å¸¸é‡çš„å‚¨å­˜ã€netronçš„è§£è¯»å¯¹åº”åˆ°ä»£ç ä¸­çš„éƒ¨åˆ†</li>
</ul>
<h3 id="onnxæ¨¡å‹æ–‡ä»¶æ­£ç¡®å¯¼å‡º">ONNXæ¨¡å‹æ–‡ä»¶æ­£ç¡®å¯¼å‡º
</h3><p>è‡ªpytorch2.5ä»¥åï¼Œonnxçš„å¯¼å‡ºæœ‰ä¸¤ä¸ªç‰ˆæœ¬exporterå®ç°ï¼š<a class="link" href="https://pytorch.org/tutorials/beginner/onnx/export_simple_model_to_onnx_tutorial.html"  target="_blank" rel="noopener"
    >export_simple_model_to_onnx_tutorial</a></p>
<h4 id="torchonnxexport">torch.onnx.export
</h4><ol>
<li>å¯¹äºä»»ä½•ç”¨åˆ°shapeã€sizeè¿”å›å€¼çš„å‚æ•°æ—¶ï¼Œä¾‹å¦‚ï¼š<code>tensor.view(tensor.size(0),-1)</code>è¿™ç±»æ“ä½œï¼Œé¿å…ç›´æ¥ä½¿ç”¨tensor.sizeçš„è¿”å›å€¼ï¼Œè€Œæ˜¯åŠ ä¸Š<strong>intè½¬æ¢</strong>ï¼Œ<code>tensor.view(int(tensor.size(0),-1)</code>,<strong>æ–­å¼€è·Ÿè¸ª</strong></li>
<li>å¯¹äºnn.Upsampleæˆ–nn.functional.interpolateå‡½æ•°ï¼Œä½¿ç”¨scale_factoræŒ‡å®šå€ç‡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨sizeå‚æ•°æŒ‡å®šå¤§å°</li>
<li>å¯¹äºreshapeã€viewæ“ä½œæ—¶ï¼Œâ€”1çš„æŒ‡å®šè¯·æ”¾åˆ°batchç»´åº¦ã€‚å…¶ä»–ç»´åº¦å¯ä»¥è®¡ç®—å‡ºæ¥å³å¯ã€‚batchç»´åº¦ç¦æ­¢æŒ‡å®šä¸ºå¤§äº-1çš„æ˜ç¡®æ•°å­—</li>
<li>torch.onnx.exportæŒ‡å®šdynamic_axeså‚æ•°ï¼Œå¹¶ä¸”åªæŒ‡å®šbatchç»´åº¦ï¼Œç¦æ­¢å…¶ä»–åŠ¨æ€</li>
<li>ä½¿ç”¨opset_version=11,ä¸è¦ä½äº11</li>
<li>é¿å…ä½¿ç”¨inplaceæ“ä½œï¼Œä¾‹å¦‚<code>y[Â·,0:2]=y[Â·,0:2]*2-0.5</code></li>
<li>å°½é‡å°‘çš„å‡ºç°5ä¸ªç»´åº¦ï¼Œä¾‹å¦‚ShuffleNet Moduleï¼Œå¯ä»¥è€ƒè™‘åˆå¹¶whé¿å…å‡ºç°5ç»´</li>
<li>å°½é‡æŠŠè®©åå¤„ç†éƒ¨åˆ†åœ¨onnxæ¨¡å‹ä¸­å®ç°ï¼Œé™ä½åå¤„ç†å¤æ‚åº¦</li>
<li>æŒæ¡äº†è¿™äº›ï¼Œå°±å¯ä»¥ä¿è¯åé¢å„ç§æƒ…å†µçš„é¡ºåˆ©äº†</li>
</ol>
<p>è¿™äº›åšæ³•çš„å¿…è¦æ€§ä½“ç°åœ¨ï¼Œç®€åŒ–è¿‡ç¨‹çš„å¤æ‚åº¦ï¼Œå»æ‰gatherã€shapeç±»çš„èŠ‚ç‚¹ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œéƒ¨åˆ†ä¸è¿™ä¹ˆæ”¹çœ‹ä¼¼ä¹Ÿæ˜¯å¯ä»¥ä½†æ˜¯éœ€æ±‚å¤æ‚åï¼Œä¾æ—§å­˜åœ¨å„ç±»é—®é¢˜ã€‚æŒ‰ç…§è¯´çš„è¿™ä¹ˆä¿®æ”¹ï¼ŒåŸºæœ¬æ€»èƒ½æˆã€‚åšäº†è¿™äº›ï¼Œå°±ä¸éœ€è¦ä½¿ç”¨onnxâ€”simpliferäº†</p>
<p>ä»¥ä¸Šå¯¼å‡ºæ–¹æ³•åœ¨å¯¼å‡ºè‡ªå®šä¹‰ç®—å­åï¼Œå¦‚æœè¦åœ¨onnxruntimeå¯¼å…¥ä½¿ç”¨ï¼Œé¦–å…ˆéœ€è¦å†<a class="link" href="https://onnxruntime.ai/docs/reference/operators/add-custom-op.html"  target="_blank" rel="noopener"
    >å®šä¹‰onnxruntimeç®—å­</a></p>
<h4 id="torchonnxexport-dynamotrue">torch.onnx.export(&hellip;, dynamo=True)
</h4><ul>
<li>using torch.export and Torch FX to capture the graph. It was released with PyTorch 2.5</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1"># Export the ONNX model</span>
</span></span><span class="line"><span class="cl"><span class="n">onnx_program</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="k">export</span><span class="p">(</span><span class="n">torch_model</span><span class="p">,</span> <span class="n">example_inputs</span><span class="p">,</span> <span class="n">dynamo</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Optimize the ONNX model</span>
</span></span><span class="line"><span class="cl"><span class="c1"># The ONNX model can be optimized with constant folding, and elimination of redundant nodes.</span>
</span></span><span class="line"><span class="cl"><span class="n">onnx_program</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Save the ONNX model</span>
</span></span><span class="line"><span class="cl"><span class="n">onnx_program</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&#34;demo.onnx&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Check the ONNX model</span>
</span></span><span class="line"><span class="cl"><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&#34;deom.onnx&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">onnx</span><span class="o">.</span><span class="n">checker</span><span class="o">.</span><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="example">Example
</h2><h3 id="simple-example">Simple Example
</h3><p><a class="link" href="https://github.com/microsoft/onnxruntime-inference-examples/blob/main/quantization/image_classification/cpu/ReadMe.md"  target="_blank" rel="noopener"
    >The example</a> has three parts:</p>
<ol>
<li>Pre-processing</li>
<li>Quantization</li>
<li>Debugging</li>
</ol>
<h3 id="yolov8">YOLOv8
</h3><ul>
<li><a class="link" href="https://github.com/loveleaves/onnx-quantization/tree/main/object_detection/YOLOv8"  target="_blank" rel="noopener"
    >code</a></li>
<li>Static Quantization</li>
</ul>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            æœ€åæ›´æ–°äº Mar 07, 2025 19:52 &#43;0800
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/quantization/">
        
        

        <div class="article-details">
            <h2 class="article-title">ã€é‡åŒ–ã€‘ ç¥ç»ç½‘ç»œé‡åŒ–ä»‹ç»</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/gpu/">
        
        

        <div class="article-details">
            <h2 class="article-title">ã€GPUã€‘ GPUæ¶æ„åŠä½¿ç”¨ä»‹ç»</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="loveleaves/loveleaves.github.io"
    data-repo-id="R_kgDOHiRxVA"
    data-category="General"
    data-category-id="DIC_kwDOHiRxVM4Cmvtx"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="zh-CN"
    data-loading=""
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark_dimmed');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2025 Andrew Stark
    </section>
    
    <section class="powerby">
        
            loveleaves <br/>
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>


<div id="aplayer"></div>
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<script>
const staticDir = "https://loveleaves.github.io/";
const musicDir = staticDir + '/music/';
const songs = [
    'Dream_It_Possible-Delacey',
    'Love_Story-Taylor_Swift',
    'Never_Gonna_Give_You_Up-Rick_Astley',
    'Natural-Imagine_Dragons',
    'Rolling_In_the_Deep-Adele',
    'Apologize-OneRepublic',
    'Salt-Ava_Max',
    'Try-P!nk',
    'That_Girl-Olly_Murs',
    'Hymn_for_the_Weekend-Coldplay',
    'Hall_of_Fame-The_Script',
    'My_Stupid_Heart-Walk_Off_the_Earth&Luminati_Suns',
    'My_Songs_Know_What_You_Did_In_the_Dark-Taylor_Swift&Fall_Out_Boy',
    'See_You_Again-Wiz_Khalifa&Charlie_Puth',
    'Uptown_Funk-Mark_Ronson&Bruno_Mars',
    'Right_Now-Akon',
    'Whistle-Flo_Rida',
    'Numb-Linkin_Park',
    'Immortals-Fall_Out_Boy',
    'DJ_Got_Us_Falling_In_Love-Krusher',
    'Faded-Alan_Walker',
    'Something_Just_Like_This-The_Chainsmokers&Coldplay',
    'The_Phoenix-Fall_Out_Boy',
    'Umbrella-Rihanna&Jay_Z',
    'Animals_(Big_Boi_Remix)-Maroon_5',
    'Monsters-Katie_Sky',
    'Turninâ€™-Young_Rising_Sons',
    'What_Are_Words-Chris_Medina',
    'Normal_No_More-Tysm',
    'Go_Solo-Tom_Rosenthal',
    'Peter_Pan_Was_Right-Anson_Seabra',
    'Free_Loop-Daniel_Powter',
    'Empty_Love-Lulleaux&Kid_Princess',
    'é’ç©º-Candy_Wind',
    'Take_Me_Hand-DAISHI_DANCE',
    'Proud_Of_You-å†¯æ›¦å¦¤',
    'Please_Donâ€™t_Go-Joel_Adams',
    'Forgettable-Project_46&Olivia',
    'Creep-Gamper_And_Dadoni',
    'Ferrari-Bebe_Rexha',
    'Legends_Never_Die(Alan_Walker_Remix)-Alan_Walker&Against_The_Current',
    'Love_the_Way_You_Lie-Eminem&Rihanna',
    'Lone_Ranger-Rachel_Platten',
    'What_Makes_You_Beautiful-One_Direction',
    'Let_Me_Down_Slowly-Alec_Benjamin',
    'My_Love-Westlife',
    'Counting_Stars-OneRepublic',
    'STAY-The_Kid_LAROI&Justin_Bieber',
    'Shape_of_You-Ed_Sheeran',
    'Booty_Music-Deep_Side',
    'Because_Of_You-Kelly_Clarkson',
    'Far_Away_from_Home-Groove_Coverage',
    'Move_Your_Body(Single_Mix)-Sia',
    'The_Nights(Original_Mix)-Avicii',
    'We_Dont_Talk_Anymore-Charlie_Puth&Selena_Gomez',
    'Moves_Like_Jagger(Radio_Edit)-Maroon_5',
    'You_Raise_Me_Up-Westlife',
    'Call_Me_Maybe(10_Kings_vs_Ollie_Green_Remix)-Carly_Rae_Jepsen',
    'Senorita-Shawn_Mendes&Camila_Cabello',
    'We_Will_Rock_You-Queen',
    'My_Heart_Will_Go_On-Celine_Dion&Webster'
];
let audios = [];
songs.forEach((item) => {
    const songInfo = item.split('-');
    audios.push({
        name: songInfo[0],
        artist: songInfo[1],
        url: musicDir + item + '/song.mp3',
        lrc: musicDir + item + '/song.lrc',
        cover: musicDir + 'cover.jpg', 
    })
});
const ap = new APlayer({
    container: document.getElementById('aplayer'),
    
    fixed: true,
    
    lrcType: 3,
    audio: audios
});
</script>





<script>
  const cdnPath = 'https://cdn.jsdelivr.net/gh/loveleaves/hugo-static-resource@main/live2d-widget-v3/';
  const myCdnPath = "https://cdn.jsdelivr.net/gh/loveleaves/hugo-static-resource@main/live2d/live2d-moc3/";
  
  const cssPath = "https://loveleaves.github.io/waifu/waifu.css";
  const tipsJsonPath = "https://loveleaves.github.io/waifu/waifu-tips.json";
  const tipsJsPath = "https://loveleaves.github.io/waifu/waifu-tips.js";
  const live2dJsPath = "https://loveleaves.github.io/waifu/live2d.min.js";

  const config = {
    
    path: {
      modelPath: myCdnPath,
      cssPath: cssPath,
      tipsJsonPath: tipsJsonPath,
      tipsJsPath: cdnPath + "/waifu-tips.js",
      live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
      live2dSdkPath: cdnPath + "/live2d-sdk.js"
    },
    
    tools: ["hitokoto", "asteroids", "express", "switch-model", "switch-texture", "quit"],
    
    drag: {
      enable: true,
      direction: ["x", "y"]
    },
    
    switchType: "order"
  }

  
  if (screen.width >= 768) {
    Promise.all([
      loadExternalResource(config.path.cssPath, "css"),
      loadExternalResource(config.path.live2dCorePath, "js"),
      loadExternalResource(config.path.live2dSdkPath, "js"),
      loadExternalResource(config.path.tipsJsPath, "js")
    ]).then(() => {
      initWidget({
        waifuPath: config.path.tipsJsonPath,
        cdnPath: config.path.modelPath,
        tools: config.tools,
        dragEnable: config.drag.enable,
        dragDirection: config.drag.direction,
        switchType: config.switchType
      });
    });
  }

  
  function loadExternalResource(url, type) {
    return new Promise((resolve, reject) => {
      let tag;
      if (type === "css") {
        tag = document.createElement("link");
        tag.rel = "stylesheet";
        tag.href = url;
      }
      else if (type === "js") {
        tag = document.createElement("script");
        tag.src = url;
      }
      if (tag) {
        tag.onload = () => resolve(url);
        tag.onerror = () => reject(url);
        document.head.appendChild(tag);
      }
    });
  }
</script>

<style>
    #TableOfContents > ul, ol {
        ul, ol {
            display: none;
        }
        .open {
            display: block;
        }
    }
</style>

<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url(https://loveleaves.github.io/icons/backTop.svg);
    }
</style>

<div id="particles-js"></div>

<script src=https://loveleaves.github.io/background/particles.min.js></script>
<script>
  particlesJS.load('particles-js', "https://loveleaves.github.io/background/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>

<script>
    

    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        
        window.onscroll = function() {
            
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };
    }

    

    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>

<script>
    function initTocHide() {
        
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        
        window.addEventListener('scroll', function() {
            
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                ul = ul.parentElement.parentElement
            } while (ul !== undefined && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>

<script>
    

    window.onbeforeunload = () => {
        
        const playInfo = {
            index: ap.list.index,
            currentTime: ap.audio.currentTime,
            paused: ap.paused
        };
        localStorage.setItem("playInfo", JSON.stringify(playInfo));
    };

    

    window.onload = () => {
        
        const playInfo = JSON.parse(localStorage.getItem("playInfo"));
        if (!playInfo) {
            return;
        }
        
        ap.list.switch(playInfo.index);
        
        setTimeout(() => {
            
            ap.seek(playInfo.currentTime);
            
            if (!playInfo.paused) {
                ap.play()
            }
        }, 500);
    };
</script>

    </body>
</html>
